version: '3'

services:

  web:
    restart: always
    container_name: web_${FLASK_SERVER_TYPE}
    build:
        context: ./
        dockerfile: ./docker/flask/Dockerfile
        args:
            FLASK_PORT: ${FLASK_PORT}
            FLASK_SERVER_TYPE: ${FLASK_SERVER_TYPE}
    ports:
        - "${FLASK_PORT}:${FLASK_PORT}"
    depends_on:
        - mysql
    volumes:
        - "./app:/var/www/flask/app"
    command: sh -c "/wait && python3 run.py"
    environment:
        - WAIT_HOSTS=mysql:3306
        - WAIT_HOSTS_TIMEOUT=300
        - WAIT_SLEEP_INTERVAL=30
        - WAIT_HOST_CONNECT_TIMEOUT=30

  redis:
    image: "redis:alpine"